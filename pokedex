import json
with open(r"C:\Users\brada\OneDrive\Documents\GitHub\pokemon_project\dataset.json") as file:
    mylist = json.load(file)

import pprint

MENU = ["Search by Name",
        "Search by ID",
        "Filter by Height, Weight and Speed",
        "Select Pokemon for your team",
        "View your team",
        "Clear the Team",
        "Show all move in Pokedex(Across all pokemon)"
        ]

def pretty_print(lst):
    print("\n")
    for i in range(len(lst)):
        print(f"{i+1}. {lst[i]}")

def id_search():
    try:
        user_input = input("Enter the ID of the Pokémon: ")
        for pokemon in mylist:
            if pokemon["Id"] == user_input:
                print("Here is the match:")
                print(pokemon)
                return pokemon
        print("No Pokémon found with that ID.")
    except ValueError:
        print("Please enter a valid ID.")

def name_search(user_input):
    while True:
        try:
            matches = []
            for pokemon in mylist:
                if user_input.lower() in (pokemon["Name"].lower()):
                    matches.append(pokemon)
            if matches:
                if len(matches) == 1:
                    pprint.pp(matches)
                    print("There is only 1 pokemon that matches your search: ^Details above^")
                    print(matches[0]["Name"])
                    return matches
                elif 0 <= len(matches) <= 5:
                    print("Here are the matches:")
                    pprint.pp(matches)
                    print(f"There are {len(matches)} pokemon that match your search:")
                    print(matches[0]["Name"])
                    break  #escape loop and go back to main menu (not adding multiple pokemon, yet.)
                elif 5 <= len(matches):
                    print("Here are the matches:")
                    pprint.pp(matches)
                    print(f"There are {len(matches)} pokemon that match your search:")
                    print(matches[0]["Name"])
                    break

            else:
                print("No Pokémon found with that name.")
        except Exception as e:
            print(f"An error occurred: {e}")

def filter_by_type(mylist, type_to_filter):
    result = []
    for pokemon in mylist:
        try:
            if pokemon["Type 1"].lower() == type_to_filter.lower() or pokemon["Type 2"].lower() == type_to_filter.lower():
                result.append(pokemon)
        except ValueError:
            print("valid selection please")
    print(result)
    return result

def get_min_max():
    try:
        hmin = float(input("Enter minimum Height: "))
        hmax = float(input("Enter maximum Height: "))
        wmin = float(input("Enter minimum Weight: "))
        wmax = float(input("Enter maximum Weight: "))
        smin = float(input("Enter minimum Speed: "))
        smax = float(input("Enter maximum Speed: "))

    except ValueError:
        print("MUst be a valid number")    
    return hmin, hmax, wmin, wmax, smin, smax 

def filter_by_range(mylist, hmin, hmax, wmin, wmax, smin, smax):
    result = []
    for pokemon in mylist: 
        height = float(pokemon.get("Height (m)", 0))
        weight = float(pokemon.get("Weight (kg)", 0))
        speed = float(pokemon.get("Speed", 0))
        # print(speed, height, weight)
        if (smin <= speed <= smax and hmin <= height <= hmax and wmin <= weight <= wmax): 
            result.append(pokemon)
    pprint.pp(result)
    for i in result:
        print(i["Name"])
        print()
    return result

def move_display(alist): #plug in the list from previous function to allow move selection
    fullmoves = [] #fullmoves[0] is the name. Fullmoves[1]is the dictionary key with value["Description"]etc
    counter = 1
    print("Here are the pokemon's moves: ") # find a way to concatenate pokemon name
    for pokemon in alist:
        moves_dict = pokemon["Moves"] #access the moves key(which is has a dictionary value)
        for i in moves_dict.items():
            move_name = i[0] 
            move_description = i[1]["Description"] 
            fullmoves.append(i) # 
            print(f"{counter}.{move_name}: {move_description}")
            counter += 1
    select = input("Which moves would you like? (4 numbers space-separated): ").split()
    intselect = list(map(int, select))
    move_choices = []
    active_move_pokemon = {}
    for i in intselect:
        move_choices.append(fullmoves[i-1])
    print(move_choices)
    name = alist[0]["Name"]
    active_move_pokemon[name] = move_choices
    pprint.pp(active_move_pokemon)
    return active_move_pokemon



def add_to_team(match):
    while True:
        if len(match) == 1:
            x = input(f"Would you like to add {p} to your team? y/n: ").lower()
            try:
                if x == "y":
                    return match
                elif x == "n":
                    print(f"{p} was not added to your team")
                    return False
                elif x != "y" or x != "n":
                    print("You did not make a valid selection")
                    continue
            except Exception as e:
                print(f"An error occurred: {e}")
        else: 
            print("More than one pokemon matches that search!")

def json_write(lst):
    with open(r'C:\Users\brada\OneDrive\Documents\GitHub\pokemon_project\team.json', 'r') as json_file:
        try:    
            x = json.load(json_file)
        except (FileNotFoundError, json.JSONDecodeError):
            x = []
        x.append(lst)
        with open(r'C:\Users\brada\OneDrive\Documents\GitHub\pokemon_project\team.json', 'w') as json_file:
            json.dump(x, json_file)



def team_view():
    with open(r'C:\Users\brada\OneDrive\Documents\GitHub\pokemon_project\team.json', 'r') as json_file:
        try:
            y = json.load(json_file)
            pprint.pp(y)
        except Exception:
            print("Your team is empty!")

def team_clear():
    with open(r'C:\Users\brada\OneDrive\Documents\GitHub\pokemon_project\team.json', 'w') as json_file:
        print("Your team is now empty")


print("Welcome to the Pokédex")
while True:
    try:
        pretty_print(MENU)
        choice = int(input("Please make a selection (0 to quit): "))
        if choice == 1:
            user_input = input("Enter the name of the Pokémon: ")
            name_search(user_input)
        elif choice == 2:
            id_search()
        elif choice == 3:
            hmin, hmax, wmin, wmax, smin, smax = get_min_max()
            filter_by_range(mylist, hmin, hmax, wmin, wmax, smin, smax)
        elif choice == 4:
            p = input("Which pokemon would you like to add to your team?: ")
            o = name_search(p)
            add_to_team(o)
            if p is False:
                continue
            else:        
                activemoves = move_display(p)
                json_write(activemoves)
        elif choice == 5:
            team_view()
        elif choice == 6:
            team_clear()
        elif choice == 7:
            move_display(mylist) 
        elif choice == 0:
            print("Goodbye!")            
            break
        else:
            print("Invalid choice. Please choose a number between 0 and 7. 0 to quit")
    except ValueError:
        print("Invalid choice. Please enter a number.")